// 로그인된 사용자 학번과 이름 가져오기 (예: 로컬 스토리지에서)
const currentUserId = localStorage.getItem('currentUserId') || 'unknownId';
const currentUserName = localStorage.getItem('currentUserName') || '사용자';

// 사진 업로드 기능
const photoInput = document.getElementById('photo-input');
const photoPreview = document.getElementById('photo-preview');

photoInput.addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const img = document.createElement('img');
            img.src = e.target.result;
            img.style.width = '100%';
            photoPreview.innerHTML = '';
            photoPreview.appendChild(img);
            // 학번을 키로 사용하여 업로드된 이미지를 로컬스토리지에 저장
            localStorage.setItem(`uploadedPhoto_${currentUserId}`, e.target.result);
            updateStoryDisplay(e.target.result);
        };
        reader.readAsDataURL(file);
    }
});

// 스토리 보기 기능
function updateStoryDisplay(imageSrc) {
    const storyDisplay = document.getElementById('story-display');
    const storyDiv = document.createElement('div');
    storyDiv.classList.add('story');
    const img = document.createElement('img');
    img.src = imageSrc;
    storyDiv.appendChild(img);
    storyDisplay.appendChild(storyDiv);
}

// 로컬스토리지에 저장된 이미지 표시
const storedImage = localStorage.getItem(`uploadedPhoto_${currentUserId}`);
if (storedImage) {
    updateStoryDisplay(storedImage);
}

// 메모 작성 기능
document.getElementById('save-memo').addEventListener('click', function() {
    const memoText = document.getElementById('memo-input').value;
    localStorage.setItem(`memo_${currentUserId}`, memoText);
    displayMemo();
});

function displayMemo() {
    const memoDisplay = document.getElementById('memo-display');
    const memoText = localStorage.getItem(`memo_${currentUserId}`);
    if (memoText) {
        memoDisplay.innerHTML = `<p><span class="author">${currentUserName}:</span> ${memoText}</p>`;
    }
}

// 초기 로드 시 메모 표시
displayMemo();

// 게시물 작성 기능
document.getElementById('save-post').addEventListener('click', function() {
    const postText = document.getElementById('post-input').value;
    localStorage.setItem(`post_${currentUserId}`, postText);
    displayPost();
});

function displayPost() {
    const postDisplay = document.getElementById('post-display');
    const postText = localStorage.getItem(`post_${currentUserId}`);
    if (postText) {
        postDisplay.innerHTML = `<p><span class="author">${currentUserName}:</span> ${postText}</p>`;
    }
}

// 초기 로드 시 게시물 표시
displayPost();
